<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Identification d'Oiseaux de France</title>
  <link href="/static/css/style.css" rel="stylesheet">
  <link rel="icon" href="/static/favicon.png">
</head>

<body>
  <div class="container">
    <div class="header-section">
      <div class="header-content">
        <h1>ü¶Ö Identification d'Oiseaux de France</h1>
        <p class="subtitle">Identifiez les oiseaux gr√¢ce √† leurs caract√©ristiques observ√©es</p>
        <button id="showAllBirdsBtn" class="btn-all-birds">
          üìö Catalogue complet des oiseaux
        </button>
      </div>
    </div>

    <form id="birdForm" action="/submit" method="post">
      <div class="two-column-layout">
        <div class="form-section">
          <h2 class="section-title">Dimensions</h2>

          <div class="input-group">
            <label for="taille">Taille (cm)</label>
            <input type="text" id="taille" name="Taille" placeholder="Ex: 15">
          </div>

          <div class="input-group">
            <label for="envergure">Envergure (cm)</label>
            <input type="text" id="envergure" name="Envergure" placeholder="Ex: 40">
          </div>

          <div class="input-group">
            <label for="poids">Poids (kg)</label>
            <input type="text" id="poids" name="Poids" placeholder="Ex: 0.5">
          </div>
        </div>

        <div class="form-section">
          <h2 class="section-title">Plumage</h2>
          <label>Couleurs principales</label>
          <div class="checkbox-grid">
            <div class="option-item">
              <input type="checkbox" id="couleur_brun" name="Couleurs_principales" value="Brun">
              <label for="couleur_brun" class="option-label">
                <img src="/static/plume_brun.png" alt="Brun">
                <span>Brun</span>
              </label>
            </div>
            <div class="option-item">
              <input type="checkbox" id="couleur_gris" name="Couleurs_principales" value="Gris">
              <label for="couleur_gris" class="option-label">
                <img src="/static/plume_gris.png" alt="Gris">
                <span>Gris</span>
              </label>
            </div>
            <div class="option-item">
              <input type="checkbox" id="couleur_marron" name="Couleurs_principales" value="Marron">
              <label for="couleur_marron" class="option-label">
                <img src="/static/plume_marron.png" alt="Marron">
                <span>Marron</span>
              </label>
            </div>
            <div class="option-item">
              <input type="checkbox" id="couleur_beige" name="Couleurs_principales" value="Beige">
              <label for="couleur_beige" class="option-label">
                <img src="/static/plume_beige.png" alt="Beige">
                <span>Beige</span>
              </label>
            </div>
            <div class="option-item">
              <input type="checkbox" id="couleur_Roux" name="Couleurs_principales" value="Roux">
              <label for="couleur_Roux" class="option-label">
                <img src="/static/plume_roux.png" alt="Roux">
                <span>Roux</span>
              </label>
            </div>
            <div class="option-item">
              <input type="checkbox" id="couleur_rouge" name="Couleurs_principales" value="Rouge">
              <label for="couleur_rouge" class="option-label">
                <img src="/static/plume_rouge.png" alt="Rouge">
                <span>Rouge</span>
              </label>
            </div>
            <div class="option-item">
              <input type="checkbox" id="couleur_bleu" name="Couleurs_principales" value="Bleu">
              <label for="couleur_bleu" class="option-label">
                <img src="/static/plume_bleu.png" alt="Bleu">
                <span>Bleu</span>
              </label>
            </div>
            <div class="option-item">
              <input type="checkbox" id="couleur_vert" name="Couleurs_principales" value="Vert">
              <label for="couleur_vert" class="option-label">
                <img src="/static/plume_vert.png" alt="Vert">
                <span>Vert</span>
              </label>
            </div>
            <div class="option-item">
              <input type="checkbox" id="couleur_jaune" name="Couleurs_principales" value="Jaune">
              <label for="couleur_jaune" class="option-label">
                <img src="/static/plume_jaune.png" alt="Jaune">
                <span>Jaune</span>
              </label>
            </div>
            <div class="option-item">
              <input type="checkbox" id="couleur_noir" name="Couleurs_principales" value="Noir">
              <label for="couleur_noir" class="option-label">
                <img src="/static/plume_noir.png" alt="Noir">
                <span>Noir</span>
              </label>
            </div>
            <div class="option-item">
              <input type="checkbox" id="couleur_blanc" name="Couleurs_principales" value="Blanc">
              <label for="couleur_blanc" class="option-label">
                <img src="/static/plume_blanc.png" alt="Blanc">
                <span>Blanc</span>
              </label>
            </div>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h2 class="section-title">Bec</h2>
        <label>Type de bec</label>
        <div class="radio-grid beak-options">
          <div class="option-item">
            <input type="radio" id="bec_large" name="Bec" value="Large avec culmen prononc√©">
            <label for="bec_large" class="option-label">
              <img src="/static/large_avec_culmen_prononce.png" alt="Large avec culmen prononc√©">
              <span>Large culmen</span>
            </label>
          </div>
          <div class="option-item">
            <input type="radio" id="bec_crochu" name="Bec" value="Crochu">
            <label for="bec_crochu" class="option-label">
              <img src="/static/crochu.png" alt="Crochu">
              <span>Crochu</span>
            </label>
          </div>
          <div class="option-item">
            <input type="radio" id="bec_court" name="Bec" value="Court √† grande ouverture">
            <label for="bec_court" class="option-label">
              <img src="/static/court_a_grande_ouverture.png" alt="Court √† grande ouverture">
              <span>Court ouverture</span>
            </label>
          </div>
          <div class="option-item">
            <input type="radio" id="bec_fin" name="Bec" value="Fin">
            <label for="bec_fin" class="option-label">
              <img src="/static/fin.png" alt="Fin">
              <span>Fin</span>
            </label>
          </div>
          <div class="option-item">
            <input type="radio" id="bec_aplati" name="Bec" value="Aplati">
            <label for="bec_aplati" class="option-label">
              <img src="/static/aplati.png" alt="Aplati">
              <span>Aplati</span>
            </label>
          </div>
          <div class="option-item">
            <input type="radio" id="bec_conique" name="Bec" value="Conique">
            <label for="bec_conique" class="option-label">
              <img src="/static/conique.png" alt="Conique">
              <span>Conique</span>
            </label>
          </div>
          <div class="option-item">
            <input type="radio" id="bec_long_recourbe" name="Bec" value="Long et recourbe">
            <label for="bec_long_recourbe" class="option-label">
              <img src="/static/long_et_recourb√©.png" alt="Long et recourb√©">
              <span>Long recourb√©</span>
            </label>
          </div>
          <div class="option-item">
            <input type="radio" id="bec_long_retrousse" name="Bec" value="Long et retrousse">
            <label for="bec_long_retrousse" class="option-label">
              <img src="/static/long_et_retrouss√©.png" alt="Long et retrouss√©">
              <span>Long retrouss√©</span>
            </label>
          </div>
          <div class="option-item">
            <input type="radio" id="bec_long_en_epee" name="Bec" value="Long en √©p√©e">
            <label for="bec_long_en_epee" class="option-label">
              <img src="/static/long_en_epee.png" alt="Long en √©p√©e">
              <span>Long √©p√©e</span>
            </label>
          </div>
          <div class="option-item">
            <input type="radio" id="bec_coude" name="Bec" value="Coud√©">
            <label for="bec_coude" class="option-label">
              <img src="/static/coude.png" alt="Coud√©">
              <span>Coud√©</span>
            </label>
          </div>
          <div class="option-item">
            <input type="radio" id="bec_croise" name="Bec" value="Crois√©">
            <label for="bec_croise" class="option-label">
              <img src="/static/croise.png" alt="Crois√©">
              <span>Crois√©</span>
            </label>
          </div>
        </div>

        <label style="margin-top: 25px;">Couleur du bec</label>
        <div class="checkbox-grid">
          <div class="option-item">
            <input type="checkbox" id="couleur_bec_noir" name="Couleur_bec" value="Noir">
            <label for="couleur_bec_noir" class="option-label">
              <img src="/static/noir.png" alt="Noir">
              <span>Noir</span>
            </label>
          </div>
          <div class="option-item">
            <input type="checkbox" id="couleur_bec_jaune" name="Couleur_bec" value="Jaune">
            <label for="couleur_bec_jaune" class="option-label">
              <img src="/static/jaune.png" alt="Jaune">
              <span>Jaune</span>
            </label>
          </div>
          <div class="option-item">
            <input type="checkbox" id="couleur_bec_rouge" name="Couleur_bec" value="Rouge">
            <label for="couleur_bec_rouge" class="option-label">
              <img src="/static/rouge.png" alt="Rouge">
              <span>Rouge</span>
            </label>
          </div>
          <div class="option-item">
            <input type="checkbox" id="couleur_bec_blanc" name="Couleur_bec" value="Blanc">
            <label for="couleur_bec_blanc" class="option-label">
              <img src="/static/blanc.png" alt="Blanc">
              <span>Blanc</span>
            </label>
          </div>
          <div class="option-item">
            <input type="checkbox" id="couleur_bec_brun" name="Couleur_bec" value="Brun">
            <label for="couleur_bec_brun" class="option-label">
              <img src="/static/brun.png" alt="Brun">
              <span>Brun</span>
            </label>
          </div>
          <div class="option-item">
            <input type="checkbox" id="couleur_bec_gris" name="Couleur_bec" value="Gris">
            <label for="couleur_bec_gris" class="option-label">
              <img src="/static/gris.png" alt="Gris">
              <span>Gris</span>
            </label>
          </div>
        </div>
      </div>

      <div class="two-column-layout">
        <div class="form-section">
          <h2 class="section-title">Pattes</h2>
          <label>Type de pattes</label>
          <div class="radio-grid">
            <div class="option-item">
              <input type="radio" id="pattes_palm√©" name="Pattes" value="Palm√©">
              <label for="pattes_palm√©" class="option-label">Palm√©</label>
            </div>
            <div class="option-item">
              <input type="radio" id="pattes_serres" name="Pattes" value="serre">
              <label for="pattes_serres" class="option-label">Serres</label>
            </div>
            <div class="option-item">
              <input type="radio" id="pattes_autre" name="Pattes" value="Autre">
              <label for="pattes_autre" class="option-label">Autre</label>
            </div>
          </div>

          <label style="margin-top: 25px;">Couleur des pattes</label>
          <div class="checkbox-grid">
            <div class="option-item">
              <input type="checkbox" id="couleur_pattes_noir" name="Couleur_pattes" value="Noir">
              <label for="couleur_pattes_noir" class="option-label">
                <img src="/static/patte_noir.png" alt="Noit">
                <span>Noir</span>
              </label>
            </div>
            <div class="option-item">
              <input type="checkbox" id="couleur_pattes_jaune" name="Couleur_pattes" value="Jaune">
              <label for="couleur_pattes_jaune" class="option-label">
                <img src="/static/patte_jaune.png" alt="Jaune">
                <span>Jaune</span>
              </label>
            </div>
            <div class="option-item">
              <input type="checkbox" id="couleur_pattes_rouge" name="Couleur_pattes" value="Rouge">
              <label for="couleur_pattes_rouge" class="option-label">
                <img src="/static/patte_rouge.png" alt="Rouge">
                <span>Rouge</span>
              </label>
            </div>
            <div class="option-item">
              <input type="checkbox" id="couleur_pattes_orange" name="Couleur_pattes" value="Orange">
              <label for="couleur_pattes_orange" class="option-label">
                <img src="/static/patte_orange.png" alt="Orange">
                <span>Orange</span>
              </label>
            </div>
            <div class="option-item">
              <input type="checkbox" id="couleur_pattes_gris" name="Couleur_pattes" value="Gris">
              <label for="couleur_pattes_gris" class="option-label">
                <img src="/static/patte_gris.png" alt="Gris">
                <span>Gris</span>
              </label>
            </div>
            <div class="option-item">
              <input type="checkbox" id="couleur_pattes_brune" name="Couleur_pattes" value="Brun">
              <label for="couleur_pattes_brune" class="option-label">
                <img src="/static/patte_brun.png" alt="Brun">
                <span>Brun</span>
              </label>
            </div>
          </div>
        </div>

        <div>
          <div class="form-section">
            <h2 class="section-title">Observation</h2>
            <div class="input-group">
              <label for="mois_observation">Mois d'observation</label>
              <select id="mois_observation" name="Mois_observation">
                <option value="1">Janvier</option>
                <option value="2">F√©vrier</option>
                <option value="3">Mars</option>
                <option value="4">Avril</option>
                <option value="5">Mai</option>
                <option value="6">Juin</option>
                <option value="7">Juillet</option>
                <option value="8">Ao√ªt</option>
                <option value="9">Septembre</option>
                <option value="10">Octobre</option>
                <option value="11">Novembre</option>
                <option value="12">D√©cembre</option>
              </select>
            </div>
          </div>

          <div class="form-section">
            <h2 class="section-title">R√©gime alimentaire</h2>
            <div class="checkbox-grid">
              <div class="option-item">
                <input type="checkbox" id="regime_omnivore" name="Regime_alimentaire" value="Omnivore">
                <label for="regime_omnivore" class="option-label">Omnivore</label>
              </div>
              <div class="option-item">
                <input type="checkbox" id="regime_insectivore" name="Regime_alimentaire" value="Insectivore">
                <label for="regime_insectivore" class="option-label">Insectivore</label>
              </div>
              <div class="option-item">
                <input type="checkbox" id="regime_granivore" name="Regime_alimentaire" value="Granivore">
                <label for="regime_granivore" class="option-label">Granivore</label>
              </div>
              <div class="option-item">
                <input type="checkbox" id="regime_carnivore" name="Regime_alimentaire" value="Carnivore">
                <label for="regime_carnivore" class="option-label">Carnivore</label>
              </div>
              <div class="option-item">
                <input type="checkbox" id="regime_piscivore" name="Regime_alimentaire" value="Piscivore">
                <label for="regime_piscivore" class="option-label">Piscivore</label>
              </div>
              <div class="option-item">
                <input type="checkbox" id="regime_crustacivore" name="Regime_alimentaire" value="Crustacivore">
                <label for="regime_crustacivore" class="option-label">Crustacivore</label>
              </div>
              <div class="option-item">
                <input type="checkbox" id="regime_herbivore" name="Regime_alimentaire" value="Herbivore">
                <label for="regime_herbivore" class="option-label">Herbivore</label>
              </div>
              <div class="option-item">
                <input type="checkbox" id="regime_charognard" name="Regime_alimentaire" value="Charognard">
                <label for="regime_charognard" class="option-label">Charognard</label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <button type="submit">Identifier l'oiseau</button>
    </form>

    <div id="results-container"></div>
  </div>

  <script>
    document.getElementById('showAllBirdsBtn').addEventListener('click', async function () {
      try {
        const response = await fetch('/all-birds');
        const data = await response.json();

        if (data.success) {
          displayResults(data.result);
          setTimeout(() => {
            document.getElementById('results-container').scrollIntoView({ behavior: 'smooth' });
          }, 100);
        }
      } catch (error) {
        console.error('Erreur:', error);
        alert('Une erreur est survenue lors du chargement des oiseaux.');
      }
    });

    document.getElementById('birdForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const formData = new FormData(this);

      try {
        const response = await fetch('/submit', {
          method: 'POST',
          body: formData
        });

        const data = await response.json();

        if (data.success) {
          displayResults(data.result);
          setTimeout(() => {
            document.getElementById('results-container').scrollIntoView({ behavior: 'smooth' });
          }, 100);
        }
      } catch (error) {
        console.error('Erreur:', error);
        alert('Une erreur est survenue lors de l\'identification.');
      }
    });

    function displayResults(birds) {
      const container = document.getElementById('results-container');

      let html = `
        <div class="results">
          <h2>Oiseaux correspondants</h2>
          <div class="birds-container">
      `;

      birds.forEach((bird, index) => {
        const formatValue = (value) => {
          if (Array.isArray(value)) {
            return value.length > 0 ? value[0] + (value.length > 1 ? ` - ${value[1]}` : '') : '-';
          }
          return value || '-';
        };

        const imagePath = `/static/${bird.Nom_latin}.jpg`;

        html += `
          <div class="bird-card">
            <div class="bird-header" onclick="toggleBirdDetails('bird-${index}')">
              <div class="bird-title">
                <h3>${bird.Nom}</h3>
                <p class="bird-latin">${bird.Nom_latin}</p>
              </div>
              <img src="${imagePath}" alt="${bird.Nom}" class="bird-header-image" onerror="this.style.display='none'">
              <div class="bird-type">
                <span class="type-badge">${bird.Type} (Score: ${bird.score.toFixed(2)})</span>
              </div>
              <span class="expand-icon">‚ñº</span>
            </div>
            
            <div id="bird-${index}" class="bird-details" style="display: none;">
              <div class="details-content">
                <div class="details-grid">
                <div class="detail-row">
                  <strong>Taille:</strong>
                  <span>${formatTaille(bird.Taille)} cm</span>
                </div>
                
                <div class="detail-row">
                  <strong>Envergure:</strong>
                  <span>${formatTaille(bird.Envergure)} cm</span>
                </div>
                
                <div class="detail-row">
                  <strong>Poids:</strong>
                  <span>${formatPoids(bird.Poids)} kg</span>
                </div>
                
                <div class="detail-row">
                  <strong>Couleurs principales:</strong>
                  <span class="color-tags">
                    ${bird.Couleurs_principales.map(c => `<span class="tag">${c}</span>`).join('')}
                  </span>
                </div>
                
                <div class="detail-row">
                  <strong>Bec:</strong>
                  <span>${bird.Bec}</span>
                </div>
                
                <div class="detail-row">
                  <strong>Couleur du bec:</strong>
                  <span class="color-tags">
                    ${bird.Couleur_bec.map(c => `<span class="tag">${c}</span>`).join('')}
                  </span>
                </div>
                
                <div class="detail-row">
                  <strong>Pattes:</strong>
                  <span>${bird.Pattes}</span>
                </div>
                
                <div class="detail-row">
                  <strong>Couleur des pattes:</strong>
                  <span class="color-tags">
                    ${bird.Couleur_pattes.map(c => `<span class="tag">${c}</span>`).join('')}
                  </span>
                </div>
                
                <div class="detail-row">
                  <strong>R√©gime alimentaire:</strong>
                  <span class="color-tags">
                    ${bird.Regime_alimentaire.map(r => `<span class="tag">${r}</span>`).join('')}
                  </span>
                </div>
                
                ${bird.Periode_d_abscence && bird.Periode_d_abscence.length > 0 ? `
                  <div class="detail-row">
                    <strong>P√©riode d'absence:</strong>
                    <span>Mois: ${bird.Periode_d_abscence.map(m => getMoisName(m)).join(", ")}</span>
                  </div>
                ` : ''}
                </div>
                <img src="${imagePath}" alt="${bird.Nom}" class="bird-detail-image" onerror="this.style.display='none'">
              </div>
            </div>
          </div>
        `;
      });

      html += `
          </div>
        </div>
      `;

      container.innerHTML = html;
    }

    function formatTaille(value) {
      if (Array.isArray(value)) {
        return `${value[0]} - ${value[1]}`;
      }
      return value;
    }

    function formatPoids(value) {
      if (Array.isArray(value)) {
        return `${value[0]} - ${value[1]}`;
      }
      return value;
    }

    function toggleBirdDetails(birdId) {
      const details = document.getElementById(birdId);
      const card = details.closest('.bird-card');

      if (details.style.display === "none") {
        details.style.display = "block";
        card.classList.add('expanded');
      } else {
        details.style.display = "none";
        card.classList.remove('expanded');
      }
    }

    function getMoisName(numMois) {
      const mois = ['', 'Janvier', 'F√©vrier', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Ao√ªt', 'Septembre', 'Octobre', 'Novembre', 'D√©cembre'];
      return mois[numMois] || '';
    }
  </script>
</body>

</html>
